`run.sh` starts a test environment that includes:

* local beam broker
* 2 beam proxies
  * proxy1 simulates a bridgehead
    * focus
    * blaze
      * imports the data from `json-fhir-bundles` directory on startup
    * postgresql
    * fhir2sql
      * exports the blaze data into postgres on startup
  * proxy2 simulates the central dashboard
    * spot

Exposed are postgres on :5432 and spot on :8055

`npm start` runs the dashboard and it expects spot at localhost:8055

The test data in the `json-fhir-bundles` directory is generated by `generate-fhir-bundles-for-testing.py`. The shape of the data is based on the latest centraxx profiles https://github.com/samply/organoide_cxx_messprofile and real but outdated centraxx to fhir exports in the `fhir-bundles-from-centraxx` directory.

## Testing SQL queries

To test SQL queries you can run them directly against postgres:

    psql postgresql://postgres:pgpass123@localhost/postgres -f resources/sql/ORGANOID_DASHBOARD_INTERNAL_METPREDICT

To test a query with the dashboard you need to build a local focus image. Go to your local focus clone and copy the query to `resources/sql` then build a local image:

    docker image rm samply/focus:localbuild; ./dev/focusdev build --features dktk

Adjust `docker-compose.yml` to use the local image.